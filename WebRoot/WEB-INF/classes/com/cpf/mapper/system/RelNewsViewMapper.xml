<?xml version="1.0" encoding="UTF-8" ?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" "http://mybatis.org/dtd/mybatis-3-mapper.dtd" >
<mapper namespace="com.cpf.mapper.system.RelNewsViewMapper" >
  <resultMap id="BaseResultMap" type="com.cpf.beans.system.RelNewsView" >
    <!--
      WARNING - @mbggenerated
      This element is automatically generated by MyBatis Generator, do not modify.
    -->
    <id column="viewid" property="viewid" jdbcType="VARCHAR" />
    <result column="userid" property="userid" jdbcType="VARCHAR" />
    <result column="state" property="state" jdbcType="VARCHAR" />
    <result column="newsid" property="newsid" jdbcType="VARCHAR" />
    
  </resultMap>
  
    <resultMap id="newsResultMap" type="com.cpf.beans.system.RelNewsView" >
    <!--
      WARNING - @mbggenerated
      This element is automatically generated by MyBatis Generator, do not modify.
    -->
    <id column="viewid" property="viewid" jdbcType="VARCHAR" />
    <result column="userid" property="userid" jdbcType="VARCHAR" />
    <result column="state" property="state" jdbcType="VARCHAR" />
    <result column="newsid" property="newsid" jdbcType="VARCHAR" />
    
     <association property="news" javaType="com.cpf.beans.system.SysNews">   
            <id column="newsid" jdbcType="VARCHAR" property="newsid" />
    <result column="newcontent" jdbcType="VARCHAR" property="newcontent" />
    <result column="sendtime" jdbcType="DATE" property="sendtime" />
    <result column="newstype" jdbcType="CHAR" property="newstype" />
    <result column="tradingid" jdbcType="VARCHAR" property="tradingid" />
        </association>
  </resultMap>
  <sql id="Base_Column_List" >
    <!--
      WARNING - @mbggenerated
      This element is automatically generated by MyBatis Generator, do not modify.
    -->
    viewid, userid, state, newsid
  </sql>
 
 	<!-- 根据登录用户id查询所有的消息,分页 -->
 	<select id="selectUserMessage" resultMap="newsResultMap">
		 select * from rel_news_view v LEFT JOIN sys_news n on v.newsid = n.newsid
		where v.userid = #{userId} and n.newstype = #{newsType}
		order by n.sendtime desc limit #{beginIndex},#{endIndex}
 	 </select>
 	 
 	  	<!-- 为上面的分页查询总条数 -->
 	<select id="selectUserMessageCount" resultType="java.lang.Integer">
		 select count(v.viewid) from rel_news_view v LEFT JOIN sys_news n on v.newsid = n.newsid
		where v.userid = #{userId} and n.newstype = #{newsType}
		order by n.sendtime desc  
 	 </select>
 	 
 	 <!-- 查询用户的未读消息 -->
 	 <select id="selectUnreadMessageCount" resultType="java.lang.Integer">
 	 	select count(v.newsid) from rel_news_view v where v.userid =#{userId} and v.state ='1'
 	 </select>
 	 
 	 <!-- 修改消息为已读状态状态 -->
 	 <update id="updateMessageStatus" >
 	 		update rel_news_view t set t.state ='0' where t.viewid = #{viewId} 
 	 </update>
</mapper>