<?xml version="1.0" encoding="UTF-8" ?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" "http://mybatis.org/dtd/mybatis-3-mapper.dtd" >
<mapper namespace="com.cpf.mapper.transaction.TraOfficialspecialMapper" >
  <resultMap id="BaseResultMap" type="com.cpf.beans.transaction.TraOfficialspecial" >
    <!--
      WARNING - @mbggenerated
      This element is automatically generated by MyBatis Generator, do not modify.
    -->
    <id column="Officialid" property="officialid" jdbcType="VARCHAR" />
    <result column="Specialname" property="specialname" jdbcType="VARCHAR" />
    <result column="Specialcover" property="specialcover" jdbcType="VARCHAR" />
    <result column="Previewbegintimetime" property="previewbegintimetime" jdbcType="DATE" />
    <result column="Previewendtime" property="previewendtime" jdbcType="DATE" />
    <result column="Auctionbegintime" property="auctionbegintime" jdbcType="DATE" />
    <result column="Auctionendtime" property="auctionendtime" jdbcType="DATE" />
    <result column="state" property="state" jdbcType="VARCHAR" />
    <result column="userid" property="userid" jdbcType="VARCHAR" />
    <result column="is_best" property="isBest" jdbcType="VARCHAR" />
    
    <result column="sc" property="sc" jdbcType="VARCHAR"/><!-- 收藏次数 -->
    <result column="cj" property="cj" jdbcType="VARCHAR"/><!-- 出价次数 -->
    <result column="ppc" property="ppc" jdbcType="VARCHAR"/><!-- 拍品数量 -->
    <result column="rs" property="rs" jdbcType="VARCHAR"/> <!-- 参与人数 -->
  </resultMap>
  
  <!-- 查询官方的精品专场根据输入的数量查询条数 -->
  <select id="findBestSpecialList" resultMap="BaseResultMap">
	   select o.Officialid Officialid,o.Auctionbegintime Auctionbegintime,o.Auctionendtime Auctionendtime,o.Specialname Specialname,count(c.collectId) sc,count(b.Specialid) cj,count(t.tradingid) ppc,COUNT(DISTINCT(b.userid)) rs from tra_officialspecial o 
		LEFT JOIN sys_collect c on o.Officialid = c.productId and c.collectType = '2'
		LEFT JOIN tra_Bidrecord b on o.Officialid = b.Specialid
		LEFT JOIN tra_trading t on o.Officialid = t.zcid and t.isAudit ='0'
		 where o.is_best = '0' and o.Previewbegintimetime &lt;= now() 
		group by Officialid,Auctionbegintime,Auctionendtime,Specialname
		order by o.Previewbegintimetime LIMIT #{count}  
	  
  </select>
  
  <!-- 官方专场 根据输入查询 列表 -->
    <select id="findOfficialSpecialList" resultMap="BaseResultMap">
	   select o.Officialid Officialid,o.Auctionbegintime Auctionbegintime,o.Auctionendtime Auctionendtime,o.Specialname Specialname,count(c.collectId) sc,count(b.Specialid) cj,count(t.tradingid) ppc,COUNT(DISTINCT(b.userid)) rs from tra_officialspecial o 
		LEFT JOIN sys_collect c on o.Officialid = c.productId and c.collectType = '2'
		LEFT JOIN tra_Bidrecord b on o.Officialid = b.Specialid
		LEFT JOIN tra_trading t on o.Officialid = t.zcid and t.isAudit ='0'
		where 1=1 
		<!-- 根据用户输入搜索 -->
		<if test="specialName!=null and specialName!=''">
		and o.Specialname like  CONCAT('%',#{specialName},'%')
		</if>
		<!-- 根据状态进行搜索 0 未开始1已经开始2已结束 -->
		<if test="status!=null and status!='' and status='0'">
		 and  o.Auctionbegintime &gt; now()
		</if>
		<!-- 根据状态进行搜索 0 未开始1已经开始2已结束 -->
		<if test="status!=null and status!='' and status='1'">
		 and  o.Auctionbegintime &lt;= now() and o.Auctionendtime &gt; now()
		</if>
		<!-- 根据状态进行搜索 0 未开始1已经开始2已结束 -->
		<if test="status!=null and status!='' and status='2'">
		 and  o.Auctionendtime &lt;= now()
		</if>
		
		group by Officialid,Auctionbegintime,Auctionendtime,Specialname
		order by o.Previewbegintimetime desc LIMIT #{beginIndex},#{endIndex}
  	</select>
  		<!-- 查询官方专场 根据输入查询 数量 -->
      <select id="findOfficialSpecialListCount" resultType="java.lang.Integer">
      select count(0) from (
	   select o.Officialid Officialid,o.Auctionbegintime Auctionbegintime,o.Auctionendtime Auctionendtime,o.Specialname Specialname,count(c.collectId) sc,count(b.Specialid) cj,count(t.tradingid) ppc,COUNT(DISTINCT(b.userid)) rs from tra_officialspecial o 
		LEFT JOIN sys_collect c on o.Officialid = c.productId and c.collectType = '2'
		LEFT JOIN tra_Bidrecord b on o.Officialid = b.Specialid
		LEFT JOIN tra_trading t on o.Officialid = t.zcid and t.isAudit ='0'
		where 1=1 
		<!-- 根据用户输入搜索 -->
		<if test="specialName!=null and specialName!=''">
		and o.Specialname like  CONCAT('%',#{specialName},'%')
		</if>
		<!-- 根据状态进行搜索 0 未开始1已经开始2已结束 -->
		<if test="status!=null and status!='' and status='0'">
		 and  o.Auctionbegintime &gt; now()
		</if>
		<!-- 根据状态进行搜索 0 未开始1已经开始2已结束 -->
		<if test="status!=null and status!='' and status='1'">
		 and  o.Auctionbegintime &lt;= now() and o.Auctionendtime &gt; now()
		</if>
		<!-- 根据状态进行搜索 0 未开始1已经开始2已结束 -->
		<if test="status!=null and status!='' and status='2'">
		 and  o.Auctionendtime &lt;= now()
		</if>
		
		group by Officialid,Auctionbegintime,Auctionendtime,Specialname
		order by o.Previewbegintimetime desc  ) ttt
  	</select>
</mapper>