<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" "http://mybatis.org/dtd/mybatis-3-mapper.dtd">
<mapper namespace="com.cpf.mapper.transaction.TraTradingMapper">
  <resultMap id="BaseResultMap" type="com.cpf.beans.transaction.TraTrading">
    <!--
      WARNING - @mbggenerated
      This element is automatically generated by MyBatis Generator, do not modify.
    -->
    <id column="tradingid" jdbcType="VARCHAR" property="tradingid" />
    <result column="productid" jdbcType="VARCHAR" property="productid" />
    <result column="toused" jdbcType="VARCHAR" property="toused" />
    <result column="isshelf" jdbcType="VARCHAR" property="isshelf" />
    <result column="Startingprice" jdbcType="DOUBLE" property="startingprice" />
    <result column="Reserveprice" jdbcType="DOUBLE" property="reserveprice" />
    <result column="isNoreserveprice" jdbcType="VARCHAR" property="isnoreserveprice" />
    <result column="zcid" jdbcType="VARCHAR" property="zcid" />
    <result column="Barterneeds" jdbcType="VARCHAR" property="barterneeds" />
    <result column="fare" jdbcType="VARCHAR" property="fare" />
    <result column="onInsurance" jdbcType="VARCHAR" property="oninsurance" />
    <result column="onReturns" jdbcType="VARCHAR" property="onreturns" />
    <result column="isAudit" jdbcType="CHAR" property="isaudit" />
    <result column="auditDate" jdbcType="DATE" property="auditdate" />
      <result column="zcType" jdbcType="CHAR" property="zcType" />
      <result column="is_hot" jdbcType="CHAR" property="isHot" />
      <result column="is_deal" jdbcType="CHAR" property="isDeal" />
      <result column="dealdate" jdbcType="DATE" property="dealdate" />
      <result column="begintime" jdbcType="DATE" property="begintime" />
      <result column="endtime" jdbcType="DATE" property="endtime" />
         <association property="production" javaType="com.cpf.beans.transaction.TraProduct">   
            <id column="productid" jdbcType="VARCHAR" property="productid" />
		    <result column="productcode" jdbcType="VARCHAR" property="productcode" />
		    <result column="userid" jdbcType="VARCHAR" property="userid" />
		    <result column="productname" jdbcType="VARCHAR" property="productname" />
		    <result column="author" jdbcType="VARCHAR" property="author" />
		    <result column="cateid" jdbcType="VARCHAR" property="cateid" />
		    <result column="isfinished" jdbcType="VARCHAR" property="isfinished" />
		    <result column="defect" jdbcType="VARCHAR" property="defect" />
		    <result column="isOriginal" jdbcType="VARCHAR" property="isoriginal" />
		    <result column="ismyself" jdbcType="VARCHAR" property="ismyself" />
		    <result column="longl" jdbcType="VARCHAR" property="longl" />
		    <result column="width" jdbcType="VARCHAR" property="width" />
		    <result column="Material" jdbcType="VARCHAR" property="material" />
		    <result column="Framed" jdbcType="VARCHAR" property="framed" />
		    <result column="shape" jdbcType="VARCHAR" property="shape" />
		    <result column="era" jdbcType="VARCHAR" property="era" />
		    <result column="cretime" jdbcType="DATE" property="cretime" />
		    <result column="state" jdbcType="VARCHAR" property="state" />
		    <result column="isMultiple" jdbcType="DECIMAL" property="ismultiple" />
		    <result column="modDate" jdbcType="DATE" property="moddate" />
		    <result column="num" jdbcType="VARCHAR" property="num"/>
		    <result column="storename"  jdbcType="VARCHAR"  property="storename"/>
		     <collection property="pics" ofType="com.cpf.beans.transaction.TraProductFiles">
				     <id column="filesid" property="filesid" jdbcType="VARCHAR" />
				    <result column="productid" property="productid" jdbcType="VARCHAR" />
				    <result column="files" property="files" jdbcType="VARCHAR" />
    			</collection>
            </association>
  </resultMap>
 
   
   <!-- 查询 物品详情-->
   <select id="findProductionById" resultMap="BaseResultMap">
  		select * from tra_trading t LEFT JOIN tra_product p on t.productid = p.productid LEFT JOIN tra_product_files f on t.productid = f.productid where t.productid =#{productId} and t.isAudit = '0' 
   </select>
   
   
   <insert id="save" parameterType="TraTrading" >
    insert into tra_trading
   	<selectKey resultType="java.lang.String"  order="BEFORE" keyProperty="tradingid">  
	 	 	  SELECT REPLACE(UUID(), '-', '')   
	    </selectKey> 
    <trim prefix="(" suffix=")" suffixOverrides="," >
      <if test="tradingid != null" >
        tradingid,
      </if>
      <if test="productid != null" >
        productid,
      </if>
      <if test="toused != null" >
        toused,
      </if>
      <if test="isshelf != null" >
        isshelf,
      </if>
      <if test="Startingprice != null" >
        Startingprice,
      </if>
      <if test="Reserveprice != null" >
        Reserveprice,
      </if>
      <if test="isNoreserveprice != null" >
        isNoreserveprice,
      </if>
      <if test="birthday != null" >
        birthday,
      </if>
      <if test="zcid != null" >
        zcid,
      </if>
      <if test="Barterneeds != null" >
        Barterneeds,
      </if>
      <if test="fare != null" >
        fare,
      </if>
      <if test="onInsurance != null" >
        onInsurance,
      </if>
      <if test="onReturns != null" >
        onReturns,
      </if>
      <if test="isAudit != null" >
        isAudit,
      </if>
      <if test="auditDate != null" >
        auditDate,
      </if>
      <if test="zcType != null" >
        zcType,
      </if>
      <if test="is_hot != null" >
        is_hot,
      </if>
      <if test="is_deal != null" >
        is_deal,
      </if>
      <if test="dealdate != null" >
        dealdate,
      </if>
    </trim>
    <trim prefix="values (" suffix=")" suffixOverrides="," >
      <if test="userinfoid != null" >
        #{userinfoid,jdbcType=VARCHAR},
      </if>
      <if test="tradingid != null" >
        #{tradingid,jdbcType=VARCHAR},
      </if>
      <if test="productid != null" >
      #{productid,jdbcType=VARCHAR},
      </if>
      <if test="toused != null" >
        #{toused,jdbcType=VARCHAR},
      </if>
      <if test="isshelf != null" >
       #{isshelf,jdbcType=VARCHAR},
      </if>
      <if test="Startingprice != null" >
        #{Startingprice,jdbcType=VARCHAR},
      </if>
      <if test="Reserveprice != null" >
        #{Reserveprice,jdbcType=VARCHAR},
      </if>
      <if test="isNoreserveprice != null" >
        #{isNoreserveprice,jdbcType=VARCHAR},
      </if>
      <if test="birthday != null" >
        #{birthday,jdbcType=VARCHAR},
      </if>
      <if test="zcid != null" >
          #{zcid,jdbcType=VARCHAR},
      </if>
      <if test="Barterneeds != null" >
         #{Barterneeds,jdbcType=VARCHAR},
      </if>
      <if test="fare != null" >
         #{fare,jdbcType=VARCHAR},
      </if>
      <if test="onInsurance != null" >
       #{onInsurance,jdbcType=VARCHAR},
      </if>
      <if test="onReturns != null" >
        #{onReturns,jdbcType=VARCHAR},
      </if>
      <if test="isAudit != null" >
        #{isAudit,jdbcType=VARCHAR},
      </if>
      <if test="auditDate != null" >
         #{auditDate,jdbcType=VARCHAR},
      </if>
      <if test="zcType != null" >
         #{zcType,jdbcType=VARCHAR},
      </if>
      <if test="is_hot != null" >
       #{is_hot,jdbcType=VARCHAR},
      </if>
      <if test="is_deal != null" >
         #{is_deal,jdbcType=VARCHAR},
      </if>
      <if test="dealdate != null" >
       #{dealdate,jdbcType=VARCHAR},
      </if>
    </trim>
  </insert>
  
  
  <resultMap id="firstResultMap" type="com.cpf.beans.transaction.TraTrading">
    <!--
      WARNING - @mbggenerated
      This element is automatically generated by MyBatis Generator, do not modify.
    -->
    <id column="tradingid" jdbcType="VARCHAR" property="tradingid" />
    <result column="productid" jdbcType="VARCHAR" property="productid" />
    <result column="toused" jdbcType="VARCHAR" property="toused" />
    <result column="isshelf" jdbcType="VARCHAR" property="isshelf" />
    <result column="Startingprice" jdbcType="DOUBLE" property="startingprice" />
    <result column="Reserveprice" jdbcType="DOUBLE" property="reserveprice" />
    <result column="isNoreserveprice" jdbcType="VARCHAR" property="isnoreserveprice" />
    <result column="zcid" jdbcType="VARCHAR" property="zcid" />
    <result column="Barterneeds" jdbcType="VARCHAR" property="barterneeds" />
    <result column="fare" jdbcType="VARCHAR" property="fare" />
    <result column="onInsurance" jdbcType="VARCHAR" property="oninsurance" />
    <result column="onReturns" jdbcType="VARCHAR" property="onreturns" />
    <result column="isAudit" jdbcType="CHAR" property="isaudit" />
    <result column="auditDate" jdbcType="DATE" property="auditdate" />
      <result column="zcType" jdbcType="CHAR" property="zcType" />
      <result column="is_hot" jdbcType="CHAR" property="isHot" />
      <result column="is_deal" jdbcType="CHAR" property="isDeal" />
      <result column="dealdate" jdbcType="DATE" property="dealdate" />
      <result column="begintime" jdbcType="DATE" property="begintime" />
      <result column="endtime" jdbcType="DATE" property="endtime" />
         <association property="production" javaType="com.cpf.beans.transaction.TraProduct">   
            <id column="productid" jdbcType="VARCHAR" property="productid" />
		    <result column="productcode" jdbcType="VARCHAR" property="productcode" />
		    <result column="userid" jdbcType="VARCHAR" property="userid" />
		    <result column="productname" jdbcType="VARCHAR" property="productname" />
		    <result column="author" jdbcType="VARCHAR" property="author" />
		    <result column="cateid" jdbcType="VARCHAR" property="cateid" />
		    <result column="isfinished" jdbcType="VARCHAR" property="isfinished" />
		    <result column="defect" jdbcType="VARCHAR" property="defect" />
		    <result column="isOriginal" jdbcType="VARCHAR" property="isoriginal" />
		    <result column="ismyself" jdbcType="VARCHAR" property="ismyself" />
		    <result column="longl" jdbcType="VARCHAR" property="longl" />
		    <result column="width" jdbcType="VARCHAR" property="width" />
		    <result column="Material" jdbcType="VARCHAR" property="material" />
		    <result column="Framed" jdbcType="VARCHAR" property="framed" />
		    <result column="shape" jdbcType="VARCHAR" property="shape" />
		    <result column="era" jdbcType="VARCHAR" property="era" />
		    <result column="cretime" jdbcType="DATE" property="cretime" />
		    <result column="state" jdbcType="VARCHAR" property="state" />
		    <result column="isMultiple" jdbcType="DECIMAL" property="ismultiple" />
		    <result column="modDate" jdbcType="DATE" property="moddate" />
		    <result column="num" jdbcType="VARCHAR" property="num"/>
		    <result column="storename"  jdbcType="VARCHAR"  property="storename"/>
            </association>
  </resultMap>
  
  <!-- 根据zcid查询品种信息,查询专场中的物品列表，并分页 -->
    <select id="findProductionByZcId" resultMap="firstResultMap">
 		select * from tra_trading t LEFT JOIN tra_product p on t.productid = p.productid   where t.zcId =#{zcId} and t.isAudit = '0' order by t.begintime desc limit #{beginIndex},#{size} 
   </select>
   <select id="findProductionByZcIdCount" resultType="java.lang.Integer">
 		select count(t.tradingid) from tra_trading t LEFT JOIN tra_product p on t.productid = p.productid   where t.zcId =#{zcId} and t.isAudit = '0'    
   </select>
</mapper>